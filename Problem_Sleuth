/* Theme created by MadCreativity - https://ahlgreen.net/ */
"use strict"
if(location.pathname !== "/preview/") {
    // Function to get date
    const fetchDate = (d) => {
        let month = (d.getMonth() + 1).toString();
        if(month.length === 1) {
            month = "0" + month;
        }

        let day = d.getDate().toString();
        if(day.length === 1) {
            day = "0" + day;
        }

        let year = (d.getFullYear() % 100).toString();
        if(year.length === 1) {
            year = "0" + year;
        }

        return `${day}/${month}/${year}`;
    };

    // Prepare HTML elements
    const container = document.createElement("div");
    container.id = "mainBlock";

    const leftBlock = document.createElement("div");
    leftBlock.id = "leftBlock";

    const middleBlock = document.createElement("div");
    middleBlock.id = "middleBlock";

    const rightBlock = document.createElement("div");
    rightBlock.id = "rightBlock";

    const commentBlock = document.createElement("div");
    commentBlock.id = "commentBlock";


    /// --- Left block --- ///
    /// Add "Latest Pages" image to left block
    const latestPagesImg = document.createElement("img");
    latestPagesImg.src = "https://file.garden/W8dmXswzE0BjIqug/MSPFA_Theme_MSPA/latestpages.png";
    latestPagesImg.className = "topImage";

    leftBlock.appendChild(latestPagesImg);


    /// Add latest pages
    const latestPages = document.createElement("div");
    latestPages.id = "pageHolder";

    leftBlock.appendChild(latestPages);


    const latestPagesLabel = document.createElement("p");
    latestPagesLabel.textContent = "Páginas Recentes:";

    latestPages.appendChild(latestPagesLabel);


    for(let i = MSPFA.story.p.length-1; i >= 0 && i >= MSPFA.story.p.length-44; i--) {
        const thisCmd = document.createElement("p");
        thisCmd.appendChild(document.createTextNode(fetchDate(new Date(MSPFA.story.p[i].d)) + " - "));

        const cmdLink = document.createElement("a");
        cmdLink.href = "/?s=" + MSPFA.story.i + "&p=" + (i+1);


        cmdLink.appendChild(document.createTextNode("\""));
        cmdLink.appendChild(MSPFA.parseBBCode(MSPFA.story.p[i].c || MSPFA.story.m));
        cmdLink.appendChild(document.createTextNode("\""));
        cmdLink.addEventListener("click", MSPFA.linkSlide);

        thisCmd.appendChild(cmdLink);
        latestPages.appendChild(thisCmd);
    }


    // Add "View All Pages" link
    const viewAllPagesContainer = document.createElement("div");
    viewAllPagesContainer.id = "viewAllPagesContainer";

    const viewAllPages = document.createElement("a");
    viewAllPages.href = "/log/?s=" + MSPFA.story.i;
    viewAllPages.textContent = "VER TODAS AS PÁGINAS";
    viewAllPages.id = "viewAllPages";


    viewAllPagesContainer.appendChild(viewAllPages);
    leftBlock.appendChild(viewAllPagesContainer);


    /// --- Middle block --- ///
    /// Add "Info" image to middle block
    const infoImg = document.createElement("img");
    infoImg.src = "https://file.garden/W8dmXswzE0BjIqug/MSPFA_Theme_MSPA/info.png";
    infoImg.className = "topImage";

    middleBlock.appendChild(infoImg);

    /// Add adventure info to middle block
    middleBlock.appendChild(document.createElement("br"));
    middleBlock.appendChild(document.querySelector("#infobox").childNodes[0].childNodes[1].querySelector("tr").childNodes[0]);
    middleBlock.appendChild(document.createElement("br"));
    middleBlock.appendChild(document.querySelector("#infobox").childNodes[0].childNodes[1].querySelector("tr").childNodes[0]);
    middleBlock.appendChild(document.createElement("br"));
    middleBlock.appendChild(document.querySelector("#infobox").childNodes[0].childNodes[1].getElementsByTagName("tr")[1].childNodes[0]);

    /// DESCRIPTION CODE - MANDATORY
    const data = document.createElement("span");
    data.innerHTML = `<br><br><a target="_blank" href="https://ahlgreen.net/">(MSPA Theme by MadCreativity)</a>`

    middleBlock.appendChild(data);


    /// --- Right block --- ///
    // Add "Ads" image to right block
    const adsImg = document.createElement("img");
    adsImg.src = "https://file.garden/W8dmXswzE0BjIqug/MSPFA_Theme_MSPA/ads.png";
    adsImg.className = "topImage";

    rightBlock.appendChild(adsImg);

    // Move side ad into right block
    const um3Container = document.querySelector("#um3container");
    if(um3Container !== null) {
        rightBlock.appendChild(um3Container);
    }


    ///--- Comment block ---///
    // Move comments to comment block
    const comments = document.querySelector("#commentbox");

    commentBlock.appendChild(comments);

    // Add blocks to container
    container.appendChild(leftBlock);
    container.appendChild(middleBlock);
    container.appendChild(rightBlock);
    container.appendChild(commentBlock);

    // Add container to page
    document.body.appendChild(container);


    // Move top ad to bottom
    const um = document.querySelector(".um");
    if(um !== null) {
        container.appendChild(um);
    }

    // Add copy of navbar to page
    const navCopy = document.querySelector("nav").cloneNode(true);

    container.appendChild(navCopy);

    // Add title image
    const titleImg = document.createElement("img");
    titleImg.src = "https://file.garden/W8dmXswzE0BjIqug/MSPFA_Theme_MSPA/title.png";
    titleImg.id = "titleImage";

    container.appendChild(titleImg);

    // Move copyright to bottom
    container.appendChild(document.querySelector("#details"));

    // Open comments
    const commentButton = document.querySelector("#commentbox .spoiler > div:first-child input");
    commentButton.click();
}
